@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix fcage: <http://w3id.org/fcage/> .
@prefix dash: <http://datashapes.org/dash#> .


fcage:
  sh:declare [
    sh:prefix "fcage" ;
    sh:namespace "http://w3id.org/fcage/"^^xsd:anyURI ;
  ] ;
  sh:declare [
    sh:prefix "rdf" ;
    sh:namespace "http://www.w3.org/1999/02/22-rdf-syntax-ns#"^^xsd:anyURI ;
  ] ;
.

fcage:InputDeclarationPresent
  a sh:PropertyShape ;
  sh:path fcage:hasInput ;
  sh:maxCount 1 ;
  sh:minCount 1 ;
.

fcage:InputDeclarationSingle
  a sh:PropertyShape ;
  sh:path fcage:hasInput ;
  sh:class fcage:ExecutionNode ;
.

fcage:InputDeclarationList
  a sh:PropertyShape ;
  sh:minCount 1 ;
  sh:path ( fcage:hasInput [ sh:zeroOrMorePath rdf:rest ] rdf:first ) ;
  sh:class fcage:ExecutionNode ;
.

fcage:InputDeclarationPortExplicitList
  a sh:PropertyShape ;
  sh:minCount 1 ;
  sh:path ( fcage:hasInput [ sh:zeroOrMorePath rdf:rest ] rdf:first ) ;
  sh:node [
    a sh:NodeShape ;
    sh:property [ sh:path fcage:fromPort ; sh:datatype xsd:integer ; sh:minCount 1 ; sh:maxCount 1 ] ;
    sh:property [ sh:path fcage:fromNode ; sh:class fcage:ExecutionNode ; sh:minCount 1 ; sh:maxCount 1 ] ;
  ] ;
.

fcage:InputDeclarationValidator
  a sh:NodeShape ;
  sh:targetClass fcage:ExecutionNode ;
  sh:xone (
    [ sh:property [ sh:path fcage:hasInput ; sh:maxCount 0 ] ] # exactly no Input
    [ sh:property fcage:InputDeclarationPresent, fcage:InputDeclarationSingle ] # Input-single port-implicit,
    [ sh:property fcage:InputDeclarationPresent, fcage:InputDeclarationList ] # Input-list port-implicit,
    [ sh:property fcage:InputDeclarationPresent, fcage:InputDeclarationPortExplicitList ] # Input-only port-explicit
  ) ;
  sh:message "Invalid Input declaration! Please consult the documentation on how to declare Inputs." ;
.

